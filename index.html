<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EdRegistry</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootswatch Slate -->
  <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/slate/bootstrap.min.css" rel="stylesheet">

  <!-- DataTables Bootstrap -->
  <link href="https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap5.min.css" rel="stylesheet">

  <style>
    body {
      padding: 2rem 0;
    }

    .container-custom {
      max-width: 94vw;
      margin: auto;
    }

    .dataTables_wrapper .dataTables_filter,
    .dataTables_wrapper .dataTables_length {
      margin-bottom: 1rem;
    }

    table.dataTable tbody tr:hover {
      background-color: #3a4f7a !important;
    }

    /* Stats cards */
    .stat-card {
      background: #2b3e50;
      border-radius: 8px;
      padding: 1rem;
      height: 100%;
    }

    .stat-title {
      font-size: 0.9rem;
      opacity: 0.8;
    }

    .stat-value {
      font-size: 1.4rem;
      font-weight: bold;
    }

    footer {
      margin-top: 4rem;
      padding-top: 1rem;
      border-top: 1px solid #445;
      font-size: 0.9rem;
      opacity: 0.8;
    }
  </style>
</head>
<body>

<div class="container-custom">

  <h1 class="mb-3">EdRegistry</h1>

  <div class="alert alert-secondary">
    Interactive registry of EdFiles from LEGO TTGames
  </div>

  <!-- COLUMN STATS -->
  <div class="row g-3 mt-3" id="stats-container"></div>

  <!-- TABLE -->
  <div class="card mt-4">
    <div class="card-body">
      <table id="datatable" class="table table-striped table-hover w-100">
        <thead></thead>
      </table>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="text-center mt-5">
    <p class="mb-1">
      Data generated by <a href="https://github.com/JayFrancoe" target="_blank">JayFrancoe</a>
    </p>
    <p class="mb-0">
      EdRegistry • LEGO TTGames EdFile explorer
    </p>
  </footer>

</div>

<!-- JS -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>

<script>
fetch('data/data.json')
  .then(res => res.json())
  .then(data => {

    const columnNames = Object.keys(data[0]);
    const columns = columnNames.map(k => ({ title: k, data: k }));

    // === CONFIG: columns to compute stats on ===
    const statsColumns = columnNames.slice(0, 4); // ← change here if needed

    const statsContainer = document.getElementById('stats-container');

    function computeStats(rows) {
      statsContainer.innerHTML = '';

      statsColumns.forEach(col => {
        const counts = {};
        rows.forEach(r => {
          const v = r[col] || '(empty)';
          counts[v] = (counts[v] || 0) + 1;
        });

        const top = Object.entries(counts)
          .sort((a,b) => b[1] - a[1])
          .slice(0, 3);

        const html = `
          <div class="col-md-3">
            <div class="stat-card">
              <div class="stat-title">${col}</div>
              ${top.map(t => `<div class="stat-value">${t[0]} <span class="opacity-75">(${t[1]})</span></div>`).join('')}
            </div>
          </div>
        `;
        statsContainer.insertAdjacentHTML('beforeend', html);
      });
    }

    computeStats(data);

    const table = $('#datatable').DataTable({
      data: data,
      columns: columns,
      pageLength: 100,
      lengthMenu: [50, 100, 250, 500],
      deferRender: true,
      scrollY: '65vh',
      scrollX: true,
      scroller: true,
      order: [],
      dom: 'lfrtip',
      language: {
        search: "Search:",
        lengthMenu: "Show _MENU_ entries",
        info: "Showing _START_ to _END_ of _TOTAL_ entries"
      }
    });

    table.on('search.dt draw', function () {
      const filtered = table.rows({ filter: 'applied' }).data().toArray();
      computeStats(filtered);
    });

  });
</script>

</body>
</html>
