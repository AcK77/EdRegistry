<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EdFile Registry (TTGames)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.2/dist/slate/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap5.min.css" rel="stylesheet">

  <style>
    body {
      font-size: 0.9rem;
    }

    .container-xl {
      max-width: 1600px;
    }

    table.dataTable {
      font-size: 0.85rem;
    }

    .stat-card {
      background: #272b30;
      border-radius: 0.5rem;
      padding: 0.75rem 1rem;
    }

    .stat-title {
      font-size: 0.75rem;
      opacity: 0.7;
    }

    .stat-value {
      font-size: 1.05rem;
      font-weight: 600;
    }

    footer {
      border-top: 1px solid rgba(255,255,255,0.1);
      font-size: 0.8rem;
      opacity: 0.7;
    }
  </style>
</head>

<body>

<div class="container-xl mt-4">
  <h4 class="mb-3">EdFile Registry – TTGames</h4>

  <table id="registryTable" class="table table-striped table-hover table-bordered w-100">
    <thead>
      <tr id="tableHead"></tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="row g-3 mt-4">
    <div class="col-md-3">
      <div class="stat-card">
        <div class="stat-title">Total entries</div>
        <div class="stat-value" id="statTotal">–</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stat-card">
        <div class="stat-title">Displayed</div>
        <div class="stat-value" id="statFiltered">–</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stat-card">
        <div class="stat-title">Unique values (Column 1)</div>
        <div class="stat-value" id="statCol1">–</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stat-card">
        <div class="stat-title">Unique values (Column 2)</div>
        <div class="stat-value" id="statCol2">–</div>
      </div>
    </div>
  </div>
</div>

<footer class="mt-5 py-3 text-center">
  EdFile Registry · LEGO TTGames · Static Viewer
</footer>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>

<script>
  fetch('EdRegistry.csv')
    .then(response => response.text())
    .then(csv => {
      const parsed = Papa.parse(csv, {
        header: true,
        skipEmptyLines: true
      });

      const columns = Object.keys(parsed.data[0]);

      columns.forEach(col => {
        $('#tableHead').append(`<th>${col}</th>`);
      });

      const table = $('#registryTable').DataTable({
        data: parsed.data,
        columns: columns.map(c => ({ data: c })),
        pageLength: 100,
        lengthMenu: [25, 50, 100, 250, 500],
        dom:
          "<'row mb-3'<'col-md-6'l><'col-md-6 text-end'f>>" +
          "<'row'<'col-12'tr>>" +
          "<'row mt-3'<'col-md-5'i><'col-md-7 text-end'p>>"
      });

      function updateStats() {
        const total = table.data().count();
        const filtered = table.rows({ filter: 'applied' }).count();

        const set1 = new Set();
        const set2 = new Set();

        table.rows({ filter: 'applied' }).every(function () {
          const d = this.data();
          set1.add(d[columns[0]]);
          set2.add(d[columns[1]]);
        });

        $('#statTotal').text(total);
        $('#statFiltered').text(filtered);
        $('#statCol1').text(set1.size);
        $('#statCol2').text(set2.size);
      }

      updateStats();
      table.on('draw', updateStats);
    });
</script>

</body>
</html>
